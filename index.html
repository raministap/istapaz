<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒ∞≈üTap.az - Az…ôrbaycanƒ±n i≈ü elanlarƒ± saytƒ±</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; }
        
        .header { background: #1a73e8; color: white; padding: 15px; text-align: center; }
        .nav { background: #1557b0; padding: 12px; text-align: center; }
        .nav a { color: white; text-decoration: none; margin: 0 12px; font-size: 14px; }
        
        .search-box { 
            background: #1a73e8; 
            padding: 30px; 
            text-align: center; 
        }
        .search-box input, .search-box select { 
            padding: 12px; 
            border: none; 
            border-radius: 5px; 
            margin: 5px;
            font-size: 15px;
        }
        .search-box input { width: 300px; max-width: 90%; }
        .search-box button { 
            padding: 12px 25px; 
            background: #ff6b00; 
            color: white; 
            border: none; 
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .container { max-width: 1000px; margin: 30px auto; padding: 0 15px; }
        
        .stats { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px;
        }
        .stat-card { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .stat-card h3 { color: #666; font-size: 14px; margin-bottom: 10px; }
        .stat-card .number { font-size: 28px; font-weight: bold; color: #1a73e8; }
        
        .jobs-section { background: white; padding: 25px; border-radius: 10px; }
        .jobs-section h2 { margin-bottom: 20px; color: #333; }
        
        .job-card { 
            border: 1px solid #e0e0e0; 
            padding: 20px; 
            margin-bottom: 15px; 
            border-radius: 8px;
        }
        .job-card h3 { color: #1a73e8; margin-bottom: 8px; }
        .job-card p { color: #666; margin-bottom: 5px; }
        .job-card .meta { color: #999; font-size: 13px; margin-top: 10px; }
        .job-card button { 
            background: #1a73e8; 
            color: white; 
            border: none; 
            padding: 8px 20px; 
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .loading { text-align: center; padding: 40px; color: #666; }
        .no-jobs { text-align: center; padding: 40px; color: #666; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ ƒ∞≈üTap.az</h1>
        <p>Az…ôrbaycanƒ±n i≈ü elanlarƒ± saytƒ±</p>
    </div>
    
    <div class="nav">
        <a href="index.html">üè† Ana s…ôhif…ô</a>
        <a href="add-job.html">‚ûï Vakansiya …ôlav…ô et</a>
        <a href="profile.html">üë§ Profilim</a>
        <a href="login.html" id="loginLink">üîê Giri≈ü</a>
        <a href="#" onclick="logout()" id="logoutLink" style="display:none;">üö™ √áƒ±xƒ±≈ü</a>
    </div>
    
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Vakansiya axtar...">
        <select id="searchCategory">
            <option value="">B√ºt√ºn kateqoriyalar</option>
            <option>Satƒ±≈ü</option>
            <option>Tikinti v…ô t…ômir</option>
            <option>S√ºr√ºc√ºl√ºk v…ô logistika</option>
            <option>Restoran v…ô xidm…ôt</option>
            <option>IT v…ô texnologiya</option>
        </select>
        <button onclick="searchJobs()">Axtar</button>
    </div>
    
    <div class="container">
        <div class="stats">
            <div class="stat-card">
                <h3>Aktiv vakansiya</h3>
                <div class="number" id="totalJobs">0</div>
            </div>
            <div class="stat-card">
                <h3>ƒ∞≈ü…ô g√∂t√ºr…ôn</h3>
                <div class="number" id="totalEmployers">0</div>
            </div>
            <div class="stat-card">
                <h3>ƒ∞≈ü axtaran</h3>
                <div class="number" id="totalWorkers">0</div>
            </div>
        </div>
        
        <div class="jobs-section">
            <h2>üìã Son vakansiyalar</h2>
            <div id="jobsList">
                <div class="loading">Y√ºkl…ônir...</div>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCiAg-P6g7MDv-xPsraWjHPmUdg-wGYWJU",
            authDomain: "istap-az.firebaseapp.com",
            projectId: "istap-az",
            storageBucket: "istap-az.firebasestorage.app",
            messagingSenderId: "1014728151709",
            appId: "1:1014728151709:web:8854f5e32d9812c2bffa74"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Auth state - ∆èg…ôr admin dirs…ô, birba≈üa admin panele y√∂nl…ôndir
        auth.onAuthStateChanged((user) => {
            if (user) {
                // ∆èg…ôr admin dirs…ô, admin panele y√∂nl…ôndir
                if (user.email === 'Raminboss17@gmail.com') {
                    window.location.href = 'admin.html';
                    return;
                }
                
                // Adi istifad…ô√ßi
                document.getElementById('loginLink').style.display = 'none';
                document.getElementById('logoutLink').style.display = 'inline';
            } else {
                document.getElementById('loginLink').style.display = 'inline';
                document.getElementById('logoutLink').style.display = 'none';
            }
        });

        function logout() {
            auth.signOut();
            window.location.reload();
        }

        // Load jobs
        async function loadJobs() {
            try {
                const snapshot = await db.collection('jobs')
                    .where('status', '==', 'approved')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const list = document.getElementById('jobsList');
                
                if (snapshot.empty) {
                    list.innerHTML = '<div class="no-jobs">H…ôl…ô vakansiya yoxdur.</div>';
                    return;
                }
                
                let html = '';
                snapshot.forEach(doc => {
                    const job = doc.data();
                    const date = job.createdAt ? job.createdAt.toDate().toLocaleDateString('az-AZ') : '';
                    
                    html += `
                        <div class="job-card">
                            <h3>${job.title}</h3>
                            <p><strong>${job.company}</strong></p>
                            <p>üìç ${job.city} | üí∞ ${job.salary}</p>
                            <div class="meta">üìÖ ${date} | üëÅÔ∏è ${job.views || 0} baxƒ±≈ü</div>
                            <button onclick="viewJob('${doc.id}')">∆ètraflƒ±</button>
                        </div>
                    `;
                });
                
                list.innerHTML = html;
                document.getElementById('totalJobs').textContent = snapshot.size;
                
            } catch (err) {
                document.getElementById('jobsList').innerHTML = '<div class="no-jobs">X…ôta ba≈ü verdi.</div>';
            }
        }

        function viewJob(id) {
            window.location.href = 'job-detail.html?id=' + id;
        }

        function searchJobs() {
            const text = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('searchCategory').value;
            
            // Filter logic here...
            alert('Axtarƒ±≈ü: ' + text + (category ? ' | Kateqoriya: ' + category : ''));
        }

        // Load stats
        async function loadStats() {
            try {
                const employers = await db.collection('users').where('userType', '==', 'employer').get();
                const workers = await db.collection('users').where('userType', '==', 'worker').get();
                
                document.getElementById('totalEmployers').textContent = employers.size;
                document.getElementById('totalWorkers').textContent = workers.size;
            } catch (e) {
                console.error('Stats error:', e);
            }
        }

        // Initialize
        loadJobs();
        loadStats();
    </script>
</body>
</html>
